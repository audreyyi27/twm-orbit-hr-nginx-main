// ============================================================================
// CANDIDATES.PY - WRITE/ADVANCED OPERATIONS (10 functions)
// ============================================================================

// 4. Get candidate recruitment stages
// Backend: candidates.py → @router.get("/stages/{candidate_id}")
export const getCandidateStages = async (
    candidateId: string
  ): Promise<CandidateStagesDto[]> => {
    try {
      const res = await apiFetch(`/candidates/stages/${candidateId}`, {
        method: "GET",
      });
      if (!res.ok) {
        throw new Error(`Request failed with status ${res.status}`);
      }
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while fetching candidate stages");
    }
  };
  
  // 5. Import candidates from JSON template
  // Backend: candidates.py → @router.post("/import-template")
  export const postNewCandidate = async (data: Record<string, unknown>[]) => {
    try {
      const res = await ssrApiClient<null>(
        `${BASE_URL}/candidates/import-template`,
        fetchMethod.post,
        {
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        }
      );
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while posting new candidate");
    }
  };
  
  // 6. Update candidate information
  // Backend: candidates.py → @router.put("/{id}")
  export const putCandidate = async (id: string, data: PutCandidateDto) => {
    try {
      const res = await ssrApiClient(
        `${BASE_URL}/candidates/${id}`,
        fetchMethod.put,
        {
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        }
      );
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while updating candidate");
    }
  };
  
  // 7. Update candidate recruitment stages
  // Backend: candidates.py → @router.post("/update-stages")
  export const PostCandidateStages = async (data: PostCandidateStagesDto) => {
    try {
      const res = await ssrApiClient(
        `${BASE_URL}/candidates/update-stages`,
        fetchMethod.post,
        {
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        }
      );
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while updating candidate stages");
    }
  };
  
  // 8. Batch update candidate stages
  // Backend: candidates.py → @router.post("/batch-stages")
  export const postBatchCandidateStages = async (
    data: PostCandidateStagesDto
  ) => {
    try {
      const res = await ssrApiClient<unknown>(
        `${BASE_URL}/candidates/batch-stages`,
        fetchMethod.post,
        {
          body: JSON.stringify(data),
        }
      );
      if (res.error) {
        throw new Error(res.error.message);
      }
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while batch updating stages");
    }
  };
  
  // 9. Get email template for candidate
  // Backend: candidates.py → @router.get("/{id}/email/{type}")
  export const getEmailTemplate = async (id: string, type: EmailTemplateEnum) => {
    try {
      const res = await ssrApiClient<{ template: string }>(
        `${BASE_URL}/candidates/${id}/email/${type}`,
        fetchMethod.get
      );
      if (res.error) {
        throw new Error(res.error.message);
      }
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while fetching email template");
    }
  };
  
  // 10. Send email to candidate
  // Backend: candidates.py → @router.post("/{id}/send-email")
  export const postSendEmail = async (id: string, data: PostSendEmailDto) => {
    try {
      const res = await ssrApiClient(
        `${BASE_URL}/candidates/${id}/send-email`,
        fetchMethod.post,
        {
          body: JSON.stringify(data),
        }
      );
      if (res.error) {
        throw new Error(res.error.message);
      }
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while sending email");
    }
  };
  
  // 11. Get candidate resume/CV file
  // Backend: candidates.py → @router.get("/{id}/resume")
  export const getCandidateResume = async (id: string) => {
    try {
      const res = await ssrFileClient(
        `${BASE_URL}/candidates/${id}/resume`,
        fetchMethod.get
      );
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while fetching candidate resume");
    }
  };
  
  // 12. Download JSON template for bulk import
  // Backend: candidates.py → @router.get("/template")
  export const getCandidateJsonTemplate = async () => {
    try {
      const res = await ssrFileClient(
        `${BASE_URL}/candidates/template`,
        fetchMethod.get
      );
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while fetching JSON template");
    }
  };
  
  // 13. Batch upload CV files
  // Backend: candidates.py → @router.post("/batch-upload-resumes")
  export const postCandidateCv = async (data: FormData) => {
    try {
      const res = await ssrApiClient<null>(
        `${BASE_URL}/candidates/batch-upload-resumes`,
        fetchMethod.post,
        {
          body: data,
        }
      );
      if (res.error) {
        throw new Error(res.error.message);
      }
      return res;
    } catch (err: unknown) {
      if (err instanceof Error) {
        throw err;
      }
      throw new Error("Unknown error while uploading CVs");
    }
  };
  
  // ============================================================================
  // TYPE EXPORTS
  // ============================================================================

  export type GetCandidatesType = typeof getCandidates;
export type GetCandidateType = typeof getCandidate;
export type GetCandidateCountType = typeof getCandidateCount;

export type GetCandidateStagesType = typeof getCandidateStages;
export type PostCandidateStagesType = typeof PostCandidateStages;
export type postNewCandidateType = typeof postNewCandidate;
export type PostBatchCandidateStagesType = typeof postBatchCandidateStages;
export type GetEmailTemplateType = typeof getEmailTemplate;
export type PutCandidatetype = typeof putCandidate;
export type PostSendEmailType = typeof postSendEmail;
export type GetCandidateResumeType = typeof getCandidateResume;
export type GetCandidateJsonTemplate = typeof getCandidateJsonTemplate;
export type PostCandidateCvType = typeof postCandidateCv;